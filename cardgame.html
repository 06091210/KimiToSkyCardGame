<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランダムカードドロー</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .card {
      padding: 5px;
      width: 120px;
      background-color: #fdfdfd;
      text-align: center;
      border: 1px solid #ccc;
    }
    .card img {
      width: 100%;
      height: auto;
      border-radius: 4px;
    }
    .card-name {
      margin-top: 5px;
      font-size: 14px;
    }
    #drawnCardArea {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>デッキコードから復元してランダムにカードを引く</h2>

<textarea id="deckCode" rows="2" cols="50" placeholder="例: 1x2,2x3"></textarea><br>
<button id="loadDeckBtn" onclick="loadDeckFromCode()">デッキを復元</button>
<button onclick="drawRandomCard()">ランダムに1枚引く</button>


<div id="drawnCardArea">
  <!-- 引いたカードがここに表示されます -->
</div>

<script>
  const cards = [
    { id: 1, name: "スカイ", image: "images/sky.jpg", maxCopies: 5 },
    { id: 2, name: "スカイ(ゆるキャラ)", image: "images/skyyurukyara.jpg", maxCopies: 5 },
    { id: 3, name: "スカイのヘッドホン", image: "images/skynoheddohon.jpg", maxCopies: 5 }
  ];

  const deck = [];

  function createCardElement(card) {
    const div = document.createElement('div');
    div.className = 'card';

    const img = document.createElement('img');
    img.src = card.image;
    img.alt = card.name;
    div.appendChild(img);

    const nameDiv = document.createElement('div');
    nameDiv.className = 'card-name';
    nameDiv.textContent = card.name;
    div.appendChild(nameDiv);

    return div;
  }

  function loadDeckFromCode() {
  const code = document.getElementById('deckCode').value.trim();
  if (!code) return;

  const newDeck = [];
  const entries = code.split(',');

  for (const entry of entries) {
    const [idStr, countStr] = entry.split('x');
    const id = parseInt(idStr);
    const count = parseInt(countStr);

    const card = cards.find(c => c.id === id);
    if (!card || isNaN(count) || count <= 0 || count > card.maxCopies) {
      alert(`無効なカードIDや枚数です: ${entry}`);
      return;
    }

    for (let i = 0; i < count; i++) {
      newDeck.push(card);
    }
  }

  if (newDeck.length > 50) {
    alert("デッキは50枚までです！");
    return;
  }

  deck.length = 0;
  newDeck.forEach(card => deck.push(card));

  alert("デッキを復元しました。");

  // ✅ テキストエリアと復元ボタンを非表示にする
  document.getElementById('deckCode').style.display = 'none';
  document.getElementById('loadDeckBtn').style.display = 'none';
}

  function drawRandomCard() {
    if (deck.length === 0) {
      alert("デッキにもうカードがありません！");
      return;
    }

    const randomIndex = Math.floor(Math.random() * deck.length);
    const drawnCard = deck.splice(randomIndex, 1)[0];

    const drawnArea = document.getElementById('drawnCardArea');
    drawnArea.innerHTML = ''; // 前のカードを消す

    const cardElement = createCardElement(drawnCard);
    drawnArea.appendChild(cardElement);
  }
</script>

</body>
</html>

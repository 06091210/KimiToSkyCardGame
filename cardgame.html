<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランダムカードドロー</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;

      padding-top: 60px;
    }
    .card {
      all: unset;
      cursor: grab;
      width: 120px;
      user-select: none;
    }
    .card img {
      width: 100%;
      height: auto;
      border-radius: 0;
      pointer-events: none;
    }
    #drawnCardArea {
      margin-top: 20px;
      width: 120px;
      cursor: pointer;
    }
  </style>
</head>
<body>
<textarea id="deckCode" rows="2" cols="50" placeholder="例: 1x2,2x3"></textarea><br>
<button id="loadDeckBtn" onclick="loadDeckFromCode()">デッキを復元</button>
<div id="drawnCardArea" style="display: none;">
</div>
<script>
  const cards = [
{ id: 1, name: '怒りの解放', image: 'images/ikarinokaiho.jpg', maxCopies: 5 },
{ id: 2, name: '夢双覇王　サカタ＆リクシ', image: 'images/5C2985F1-2987-4C1D-AEFD-8E222D0326B5.jpg', maxCopies: 5 },
{ id: 3, name: '森林の勇者　ソロン', image: 'images/03D903E2-D711-437D-B313-0E3BDBAAFA1D.jpg', maxCopies: 5 },
{ id: 4, name: '霊墓グレイブ＝ブリザード', image: 'images/AE07862D-1F23-4312-A6D8-6748E7BF5A23.jpg', maxCopies: 5 },
{ id: 5, name: 'にんじんの収穫祭', image: 'images/ACF4BE2A-C659-41F2-896B-C9E942D3D748.jpg', maxCopies: 5 },
{ id: 6, name: '天空の勇者　スカイ', image: 'images/781DEF8E-243D-45CF-9EFE-926CD21941E4.jpg', maxCopies: 5 },
{ id: 7, name: '霊速ブランチ', image: 'images/9A90E905-FCFB-48FA-9F9D-317535EE466E.jpg', maxCopies: 5 },
{ id: 8, name: '新星旋律龍セイファリア', image: 'images/AA96AE97-7A60-4B68-951B-1F9E58E71821.jpg', maxCopies: 5 }
  ];
  const deck = [];
  function createCardElement(card) {
    const div = document.createElement('div');
    div.className = 'card';
    div.draggable = true;
    div.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', card.id); 
    });
    const img = document.createElement('img');
    img.src = card.image;
    img.alt = card.name;
    div.appendChild(img);
    return div;
  }
  function loadDeckFromCode() {
    const code = document.getElementById('deckCode').value.trim();
    if (!code) return;
    const newDeck = [];
    const entries = code.split(',');
    for (const entry of entries) {
      const [idStr, countStr] = entry.split('x');
      const id = parseInt(idStr);
      const count = parseInt(countStr);
      const card = cards.find(c => c.id === id);
      if (!card || isNaN(count) || count <= 0 || count > card.maxCopies) {
        alert(`無効なカードIDや枚数です: ${entry}`);
        return;
      }
      for (let i = 0; i < count; i++) {
        newDeck.push(card);
      }
    }
    if (newDeck.length > 50) {
      alert("デッキは50枚までです！");
      return;
    }
    deck.length = 0;
    newDeck.forEach(card => deck.push(card));
    document.getElementById('deckCode').style.display = 'none';
    document.getElementById('loadDeckBtn').style.display = 'none';
    const drawnArea = document.getElementById('drawnCardArea');
    drawnArea.style.display = 'block';
    drawnArea.innerHTML = `
      <img src="images/brank.jpeg" alt="カードを引く" style="width: 100%; border-radius: 4px;">
    `;
  }
  document.getElementById('drawnCardArea').addEventListener('click', drawRandomCard);
  function drawRandomCard() {
  if (deck.length === 0) {
    alert("デッキにもうカードがありません！");
    return;
  }
  const randomIndex = Math.floor(Math.random() * deck.length);
  const drawnCard = deck.splice(randomIndex, 1)[0];
  const drawnArea = document.getElementById('drawnCardArea');
  if (!drawnArea.querySelector('img[src="images/brank.jpeg"]')) {
    const brankImg = document.createElement('img');
    brankImg.src = 'images/brank.jpeg';
    brankImg.alt = 'カードを引く';
    brankImg.style.width = '100%';
    brankImg.style.borderRadius = '4px';
    drawnArea.appendChild(brankImg);
  }
  const cardElement = createCardElement(drawnCard);
  drawnArea.appendChild(cardElement);
  enableDragMove(cardElement);
}
function enableDragMove(cardElement) {
  let offsetX = 0;
  let offsetY = 0;
  let isDragging = false;
  cardElement.style.position = 'absolute';
  cardElement.addEventListener('mousedown', (e) => {
    e.preventDefault();
    isDragging = true;
    const rect = cardElement.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    cardElement.style.zIndex = 1000;
  });
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    cardElement.style.left = (e.clientX - offsetX) + 'px';
    cardElement.style.top = (e.clientY - offsetY) + 'px';
  });
  document.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      cardElement.style.zIndex = '';
    }
  });
  cardElement.addEventListener('touchstart', (e) => {
    e.preventDefault();
    if (e.touches.length === 1) {
      isDragging = true;
      const touch = e.touches[0];
      const rect = cardElement.getBoundingClientRect();
      offsetX = touch.clientX - rect.left;
      offsetY = touch.clientY - rect.top;
      cardElement.style.zIndex = 1000;
    }
  }, { passive: false });
  document.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    if (e.touches.length === 1) {
      e.preventDefault();
      const touch = e.touches[0];
      cardElement.style.left = (touch.clientX - offsetX) + 'px';
      cardElement.style.top = (touch.clientY - offsetY) + 'px';
    }
  }, { passive: false });
  document.addEventListener('touchend', (e) => {
    if (isDragging) {
      isDragging = false;
      cardElement.style.zIndex = '';
    }
  });
}
</script>
</body>
</html>
